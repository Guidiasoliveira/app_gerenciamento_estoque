{% extends 'base.html' %}

{% block content %}
<h1>Sistema de Controle de Estoque</h1>

{% if estoque_baixo %}
    <div class="alert alert-danger">
        <strong>Alerta!</strong> Os seguintes produtos estão com estoque baixo:
        <ul>
            {% for produto in estoque_baixo %}
                <li>{{ produto.nome }} - Apenas {{ produto.quantidade }} em estoque!</li>
            {% endfor %}
        </ul>
    </div>
{% endif %}

<h3>Produtos no Estoque:</h3>
<table>
    <tr>
        <th>Nome</th>
        <th>Quantidade</th>
        <th>Preço</th>
    </tr>
    {% for produto in produtos %}
    <tr>
        <td>{{ produto.nome }}</td>
        <td>{{ produto.quantidade }}</td>
        <td>R$ {{ produto.preco }}</td>
    </tr>
    {% endfor %}
</table>

<a href="{{ url_for('adicionar') }}">Adicionar Novo Produto</a>

<h3>Gráfico de Quantidade de Produtos</h3>
<canvas id="estoqueChart"></canvas>

<script>
    const ctx = document.getElementById('estoqueChart').getContext('2d');
    const estoqueChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ categorias|tojson }},
            datasets: [{
                label: 'Quantidade de Produtos',
                data: {{ quantidades|tojson }},
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
{% endblock %}
